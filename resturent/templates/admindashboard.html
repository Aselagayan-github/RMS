{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Admin Dashboard</title>

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="{% static 'admind/assets/css/style.css' %}">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <input type="hidden" id="csrfToken" name="csrfmiddlewaretoken" value="{% csrf_token %}">
</head>

<body>
    <div class="dashboard-container">
        <!-- Left Navigation Bar -->
        <nav class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <div class="user-info">
                    <img src="{% static 'admind/assets/img/find_user.png' %}" class="user-image img-responsive"
                        alt="Admin User" />
                    <h3>Admin Name</h3>
                    <p>admin@example.com</p>
                </div>
                <ul class="nav" id="main-menu">
                    <li><a class="active-menu" href="#dashboard" data-view="dashboard"><i
                                class="fa fa-dashboard fa-2x"></i> Dashboard</a></li>
                    <li><a href="#order-processing" data-view="order-processing"><i class="fa fa-cogs fa-2x"></i> Order
                            Processing</a></li>
                    <li><a href="#table-bookings" data-view="table-bookings"><i class="fa fa-calendar-alt fa-2x"></i>
                            Table Bookings</a></li>
                    <li><a href="#menu-management" data-view="menu-management"><i class="fa fa-utensils fa-2x"></i> Menu
                            Management</a></li>
                    <li><a href="#delivery-management" data-view="delivery-management"><i class="fa fa-truck fa-2x"></i>
                            Delivery Management</a></li>
                    <li><a href="#invoice-management" data-view="invoice-management"><i
                                class="fa fa-file-invoice-dollar fa-2x"></i> Invoice Management</a></li>
                    <li><a href="#sales-reports" data-view="sales-reports"><i class="fa fa-chart-line fa-2x"></i> Sales
                            Reports</a></li>
                    <li><a href="#user-management" data-view="user-management"><i class="fa fa-users fa-2x"></i> User
                            Management</a></li>
                    <li><a href="#offers-discounts" data-view="offers-discounts"><i class="fa fa-tags fa-2x"></i> Offers
                            & Discounts</a></li>
                    <li><a href="#customer-feedback" data-view="customer-feedback"><i class="fa fa-comments fa-2x"></i>
                            Customer Feedback</a></li>
                    <li><a href="#customer-analytics" data-view="customer-analytics"><i class="fa fa-users fa-2x"></i> Customer Analytics</a></li>
                    <li><a href="#settings" data-view="settings"><i class="fa fa-cog fa-2x"></i> Settings</a></li>
                    <li><a href="#logout" data-view="logout"><i class="fa fa-sign-out-alt fa-2x"></i> Logout</a></li>
                </ul>
            </div>
        </nav>

        <!-- Right Side Content Area -->
        <main class="content-area" id="content-area">
            <header class="content-header">
                <h1 id="current-view-title">Dashboard</h1>
                <button id="theme-toggle" class="theme-toggle-button" title="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
            </header>

            <div class="content-main">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view active-view">
                    <h2>Dashboard Overview</h2>
                    <p>Welcome to the Restaurant Admin Dashboard. Here you'll find key metrics and quick actions.</p>
                    <div class="stats-cards">
                        <div class="card">
                            <h4>Today's Orders</h4>
                            <p>25</p>
                        </div>
                        <div class="card">
                            <h4>Pending Bookings</h4>
                            <p>5</p>
                        </div>
                        <div class="card">
                            <h4>Total Revenue (Today)</h4>
                            <p>$1,250</p>
                        </div>
                        <div class="card">
                            <h4>New Customers</h4>
                            <p>8</p>
                        </div>
                    </div>
                    <div class="row mt-4 pt-3 additional-dashboard-widgets">
                        <div class="col-lg-6 mb-4">
                            <div class="card chart-container-wrapper">
                                <div class="card-header">User Distribution</div>
                                <div class="card-body">
                                    <div class="chart-container"><canvas id="userPieChart"></canvas></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4">
                            <div class="card weather-widget-wrapper">
                                <div class="card-header">Current Weather</div>
                                <div class="card-body">
                                    <div id="weatherWidget" class="weather-widget">
                                        <p class="weather-loading">Loading weather data...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Processing View -->
                <div id="order-processing-view" class="view">
                    <div class="container-fluid py-4">
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h2><i class="fas fa-utensils"></i> Order Management</h2>
                                    <button type="button" class="btn btn-primary-custom" data-bs-toggle="modal"
                                        data-bs-target="#orderModal" onclick="openNewOrderModal()">
                                        <i class="fas fa-plus"></i> Create New Order
                                    </button>
                                </div>

                                <!-- Orders Table -->
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-list"></i> All Orders</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped" id="ordersTable">
                                                <thead>
                                                    <tr>
                                                        <th>Order ID</th>
                                                        <th>Customer Name</th>
                                                        <th>Type</th>
                                                        <th>Items</th>
                                                        <th>Total</th>
                                                        <th>Status</th>
                                                        <th>Date</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="ordersTableBody">
                                                    <!-- Orders will be loaded here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- New Order Modal -->
                    <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="orderModalLabel">Create New Order</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="orderForm">
                                        <input type="hidden" id="orderId" name="orderId">

                                        <!-- Customer Information -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="orderCustomerName" class="form-label">Customer Name</label>
                                                <input type="text" class="form-control" id="orderCustomerName"
                                                    placeholder="Enter customer name" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="orderType" class="form-label">Order Type</label>
                                                <select id="orderType" class="form-select" required>
                                                    <option value="Dine-in">Dine-in</option>
                                                    <option value="Takeaway">Takeaway</option>
                                                    <option value="Delivery">Delivery</option>
                                                </select>
                                            </div>
                                        </div>

                                        <hr class="my-3">

                                        <!-- Order Items Section -->
                                        <h5 class="mb-3">Order Items</h5>
                                        <div class="table-responsive mb-3">
                                            <table class="table table-sm">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 50%;">Item</th>
                                                        <th style="width: 15%;">Qty</th>
                                                        <th class="text-end" style="width: 20%;">Price</th>
                                                        <th class="text-center" style="width: 15%;">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="orderItemsList">
                                                    <!-- Dynamically added items will go here -->
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Add Item Form -->
                                        <div class="row g-2 align-items-end p-3 bg-light rounded">
                                            <div class="col-md-5">
                                                <label for="selectMenuItem" class="form-label mb-1 small">Select
                                                    Item</label>
                                                <select id="selectMenuItem" class="form-select form-select-sm">
                                                    <option selected disabled>Choose...</option>
                                                    <option value="1" data-price="12.50" data-name="Classic Burger">
                                                        Classic Burger</option>
                                                    <option value="2" data-price="8.00" data-name="Caesar Salad">Caesar
                                                        Salad</option>
                                                    <option value="3" data-price="7.50" data-name="Tiramisu">Tiramisu
                                                    </option>
                                                    <option value="4" data-price="3.00" data-name="Soft Drink">Soft
                                                        Drink</option>
                                                    <option value="5" data-price="15.00" data-name="Grilled Chicken">
                                                        Grilled Chicken</option>
                                                    <option value="6" data-price="9.50" data-name="Pasta Alfredo">Pasta
                                                        Alfredo</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="itemQuantity" class="form-label mb-1 small">Quantity</label>
                                                <input type="number" id="itemQuantity"
                                                    class="form-control form-control-sm" value="1" min="1">
                                            </div>
                                            <div class="col-md-4">
                                                <button type="button" class="btn btn-sm btn-outline-primary w-100"
                                                    id="addItemToOrderBtn">
                                                    <i class="fas fa-plus"></i> Add Item
                                                </button>
                                            </div>
                                        </div>

                                        <hr class="my-3">

                                        <!-- Order Summary -->
                                        <div class="row justify-content-end">
                                            <div class="col-md-5">
                                                <div class="order-summary">
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Subtotal:</span>
                                                        <span id="orderSubtotal">$0.00</span>
                                                    </div>
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Tax (8.5%):</span>
                                                        <span id="orderTax">$0.00</span>
                                                    </div>
                                                    <hr>
                                                    <div class="d-flex justify-content-between fw-bold h5">
                                                        <span>Total:</span>
                                                        <span id="orderTotal">$0.00</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary-custom" id="saveOrderBtn">
                                        <i class="fas fa-save"></i> Create Order
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    // Order management variables
                    let orderItems = [];
                    let currentOrderId = null;

                    // Initialize page
                    document.addEventListener('DOMContentLoaded', function () {
                        loadAllOrders();

                        // Add event listeners
                        document.getElementById('addItemToOrderBtn').addEventListener('click', addItemToOrder);
                        document.getElementById('saveOrderBtn').addEventListener('click', saveOrder);
                    });

                    // Open new order modal
                    function openNewOrderModal() {
                        currentOrderId = null;
                        document.getElementById('orderModalLabel').textContent = 'Create New Order';
                        document.getElementById('orderForm').reset();
                        orderItems = [];
                        updateOrderSummary();
                        clearOrderItemsList();
                    }

                    // Add item to order
                    function addItemToOrder() {
                        const selectElement = document.getElementById('selectMenuItem');
                        const quantityElement = document.getElementById('itemQuantity');

                        const selectedOption = selectElement.options[selectElement.selectedIndex];
                        const itemId = selectedOption.value;
                        const itemName = selectedOption.dataset.name;
                        const itemPrice = parseFloat(selectedOption.dataset.price);
                        const quantity = parseInt(quantityElement.value);

                        if (!itemId || itemId === 'Choose...' || quantity <= 0) {
                            alert('Please select an item and enter a valid quantity.');
                            return;
                        }

                        // Check if item already exists in order
                        const existingItemIndex = orderItems.findIndex(item => item.id === itemId);

                        if (existingItemIndex >= 0) {
                            // Update quantity of existing item
                            orderItems[existingItemIndex].quantity += quantity;
                        } else {
                            // Add new item
                            orderItems.push({
                                id: itemId,
                                name: itemName,
                                price: itemPrice,
                                quantity: quantity
                            });
                        }

                        // Reset form elements
                        selectElement.selectedIndex = 0;
                        quantityElement.value = 1;

                        // Update display
                        updateOrderItemsList();
                        updateOrderSummary();
                    }

                    // Update order items list display
                    function updateOrderItemsList() {
                        const tbody = document.getElementById('orderItemsList');
                        tbody.innerHTML = '';

                        orderItems.forEach((item, index) => {
                            const row = document.createElement('tr');
                            row.className = 'order-item-row';
                            row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td class="text-end">$${(item.price * item.quantity).toFixed(2)}</td>
                    <td class="text-center">
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeOrderItem(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                            tbody.appendChild(row);
                        });
                    }

                    // Remove item from order
                    function removeOrderItem(index) {
                        orderItems.splice(index, 1);
                        updateOrderItemsList();
                        updateOrderSummary();
                    }

                    // Update order summary calculations
                    function updateOrderSummary() {
                        const subtotal = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        const tax = subtotal * 0.085;
                        const total = subtotal + tax;

                        document.getElementById('orderSubtotal').textContent = `$${subtotal.toFixed(2)}`;
                        document.getElementById('orderTax').textContent = `$${tax.toFixed(2)}`;
                        document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
                    }

                    // Clear order items list
                    function clearOrderItemsList() {
                        document.getElementById('orderItemsList').innerHTML = '';
                    }

                    // Save order (Create or Update)
                    async function saveOrder() {
                        const customerName = document.getElementById('orderCustomerName').value;
                        const orderType = document.getElementById('orderType').value;

                        if (!customerName.trim()) {
                            alert('Please enter customer name.');
                            return;
                        }

                        if (orderItems.length === 0) {
                            alert('Please add at least one item to the order.');
                            return;
                        }

                        const subtotal = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        const tax = subtotal * 0.085;
                        const total = subtotal + tax;

                        const orderData = {
                            customer_name: customerName,
                            order_type: orderType,
                            items: orderItems,
                            subtotal: subtotal.toFixed(2),
                            tax: tax.toFixed(2),
                            total: total.toFixed(2),
                            status: 'Pending'
                        };

                        try {
                            let response;
                            if (currentOrderId) {
                                // Update existing order
                                response = await fetch(`/api/orders/${currentOrderId}/`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': getCookie('csrftoken')
                                    },
                                    body: JSON.stringify(orderData)
                                });
                            } else {
                                // Create new order
                                response = await fetch('/api/orders/', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': getCookie('csrftoken')
                                    },
                                    body: JSON.stringify(orderData)
                                });
                            }

                            if (response.ok) {
                                const result = await response.json();
                                alert(currentOrderId ? 'Order updated successfully!' : 'Order created successfully!');

                                // Close modal and refresh orders
                                const modal = bootstrap.Modal.getInstance(document.getElementById('orderModal'));
                                modal.hide();
                                loadAllOrders();
                            } else {
                                const error = await response.json();
                                alert('Error saving order: ' + (error.message || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error saving order. Please try again.');
                        }
                    }

                    // Load all orders
                    async function loadAllOrders() {
                        try {
                            const response = await fetch('/api/orders/');
                            if (response.ok) {
                                const orders = await response.json();
                                displayOrders(orders);
                            } else {
                                console.error('Error loading orders');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                        }
                    }

                    // Display orders in table
                    function displayOrders(orders) {
                        const tbody = document.getElementById('ordersTableBody');
                        tbody.innerHTML = '';

                        orders.forEach(order => {
                            const row = document.createElement('tr');

                            // Format items for display
                            const itemsDisplay = order.items.map(item => `${item.name} (${item.quantity})`).join(', ');

                            // Status badge color
                            const statusClass = getStatusBadgeClass(order.status);

                            row.innerHTML = `
                    <td>#${order._id ? order._id.slice(-6) : 'N/A'}</td>
                    <td>${order.customer_name}</td>
                    <td>${order.order_type}</td>
                    <td title="${itemsDisplay}">${itemsDisplay.length > 30 ? itemsDisplay.substring(0, 30) + '...' : itemsDisplay}</td>
                    <td>$${order.total}</td>
                    <td><span class="badge ${statusClass} status-badge">${order.status}</span></td>
                    <td>${order.created_at ? new Date(order.created_at).toLocaleDateString() : 'N/A'}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" onclick="editOrder('${order._id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="updateOrderStatus('${order._id}', 'Completed')" title="Mark Complete">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteOrder('${order._id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                            tbody.appendChild(row);
                        });
                    }

                    // Get status badge class
                    function getStatusBadgeClass(status) {
                        switch (status) {
                            case 'Pending': return 'bg-warning text-dark';
                            case 'Preparing': return 'bg-info';
                            case 'Ready': return 'bg-primary';
                            case 'Completed': return 'bg-success';
                            case 'Cancelled': return 'bg-danger';
                            default: return 'bg-secondary';
                        }
                    }

                    // Edit order
                    async function editOrder(orderId) {
                        try {
                            const response = await fetch(`/api/orders/${orderId}/`);
                            if (response.ok) {
                                const order = await response.json();

                                // Populate form with order data
                                currentOrderId = orderId;
                                document.getElementById('orderModalLabel').textContent = 'Edit Order';
                                document.getElementById('orderCustomerName').value = order.customer_name;
                                document.getElementById('orderType').value = order.order_type;

                                // Set order items
                                orderItems = order.items || [];
                                updateOrderItemsList();
                                updateOrderSummary();

                                // Show modal
                                const modal = new bootstrap.Modal(document.getElementById('orderModal'));
                                modal.show();
                            } else {
                                alert('Error loading order details');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error loading order details');
                        }
                    }

                    // Update order status
                    async function updateOrderStatus(orderId, newStatus) {
                        try {
                            const response = await fetch(`/api/orders/${orderId}/`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': getCookie('csrftoken')
                                },
                                body: JSON.stringify({ status: newStatus })
                            });

                            if (response.ok) {
                                loadAllOrders();
                            } else {
                                alert('Error updating order status');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error updating order status');
                        }
                    }

                    // Delete order
                    async function deleteOrder(orderId) {
                        if (confirm('Are you sure you want to delete this order?')) {
                            try {
                                const response = await fetch(`/api/orders/${orderId}/`, {
                                    method: 'DELETE',
                                    headers: {
                                        'X-CSRFToken': getCookie('csrftoken')
                                    }
                                });

                                if (response.ok) {
                                    alert('Order deleted successfully');
                                    loadAllOrders();
                                } else {
                                    alert('Error deleting order');
                                }
                            } catch (error) {
                                console.error('Error:', error);
                                alert('Error deleting order');
                            }
                        }
                    }

                    // Get CSRF token
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                </script>
                <!-- Table Bookings View -->
                <div id="table-bookings-view" class="view">
                    <div class="view-header d-flex justify-content-between align-items-center mb-4">
                        <h2>Table Bookings</h2>
                        <button type="button" class="btn btn-success btn-add" id="addNewBookingBtn"><i
                                class="fas fa-plus-circle me-2"></i>Add New Booking</button>
                    </div>
                    <div class="card table-card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Booking ID</th>
                                            <th>Customer</th>
                                            <th>Date & Time</th>
                                            <th>Guests</th>
                                            <th>Status</th>
                                            <th class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bookings-tbody">
                                        <!-- Orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="bookingModalLabel">Booking Details</h5><button
                                        type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="bookingForm"><input type="hidden" id="bookingId" name="bookingId">
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="bookingCustomerName"
                                                    class="form-label">Customer Name</label><input type="text"
                                                    class="form-control" id="bookingCustomerName" required></div>
                                            <div class="col-md-6 mb-3"><label for="bookingCustomerPhone"
                                                    class="form-label">Phone</label><input type="tel"
                                                    class="form-control" id="bookingCustomerPhone" required></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="bookingDate"
                                                    class="form-label">Date</label><input type="date"
                                                    class="form-control" id="bookingDate" required></div>
                                            <div class="col-md-6 mb-3"><label for="bookingTime"
                                                    class="form-label">Time</label><input type="time"
                                                    class="form-control" id="bookingTime" required></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="bookingGuests"
                                                    class="form-label">Number of Guests</label><input type="number"
                                                    class="form-control" id="bookingGuests" required min="1"></div>
                                            <div class="col-md-6 mb-3"><label for="bookingStatus"
                                                    class="form-label">Status</label><select id="bookingStatus"
                                                    class="form-select">
                                                    <option value="Confirmed">Confirmed</option>
                                                    <option value="Pending">Pending</option>
                                                    <option value="Cancelled">Cancelled</option>
                                                </select></div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button type="submit" form="bookingForm" class="btn btn-primary-custom"
                                        id="saveBookingBtn">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    // JavaScript for bookings (place in admindashboard.html or separate file)

                    // Booking management variables
                    let currentBookingId = null;

                    // Initialize page
                    document.addEventListener('DOMContentLoaded', function () {
                        loadAllBookings();

                        // Add event listeners
                        document.getElementById('addNewBookingBtn').addEventListener('click', openNewBookingModal);
                        document.getElementById('saveBookingBtn').addEventListener('click', saveBooking);

                        // Add event listeners for edit and delete buttons
                        document.getElementById('bookings-tbody').addEventListener('click', function (e) {
                            if (e.target.closest('.edit-booking-btn')) {
                                const bookingId = e.target.closest('tr').dataset.bookingId;
                                editBooking(bookingId);
                            } else if (e.target.closest('.delete-booking-btn')) {
                                const bookingId = e.target.closest('tr').dataset.bookingId;
                                deleteBooking(bookingId);
                            }
                        });
                    });

                    // Open new booking modal
                    function openNewBookingModal() {
                        currentBookingId = null;
                        document.getElementById('bookingModalLabel').textContent = 'Create New Booking';
                        document.getElementById('bookingForm').reset();
                        const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
                        modal.show();
                    }

                    // Save booking (Create or Update)
                    async function saveBooking() {
                        const customerName = document.getElementById('bookingCustomerName').value.trim();
                        const customerPhone = document.getElementById('bookingCustomerPhone').value.trim();
                        const date = document.getElementById('bookingDate').value;
                        const time = document.getElementById('bookingTime').value;
                        const guests = document.getElementById('bookingGuests').value;
                        const status = document.getElementById('bookingStatus').value;

                        // Validate form inputs
                        if (!customerName || !customerPhone || !date || !time || !guests || !status) {
                            alert('Please fill out all fields.');
                            return;
                        }

                        if (isNaN(guests) || parseInt(guests) < 1) {
                            alert('Number of guests must be a positive integer.');
                            return;
                        }

                        const bookingData = {
                            customer_name: customerName,
                            phone: customerPhone,
                            date: date,
                            time: time,
                            guests: parseInt(guests),
                            status: status
                        };

                        try {
                            let response;
                            if (currentBookingId) {
                                // Update existing booking
                                response = await fetch(`/api/bookings/${currentBookingId}/`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': getCookie('csrftoken')
                                    },
                                    body: JSON.stringify(bookingData)
                                });
                            } else {
                                // Create new booking
                                response = await fetch('/api/bookings/', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': getCookie('csrftoken')
                                    },
                                    body: JSON.stringify(bookingData)
                                });
                            }

                            if (response.ok) {
                                const result = await response.json();
                                alert(currentBookingId ? 'Booking updated successfully!' : 'Booking created successfully!');

                                // Close modal and refresh bookings
                                const modal = bootstrap.Modal.getInstance(document.getElementById('bookingModal'));
                                modal.hide();
                                loadAllBookings();
                            } else {
                                const error = await response.json();
                                alert('Error saving booking: ' + (error.error || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error saving booking. Please try again.');
                        }
                    }

                    // Load all bookings
                    async function loadAllBookings() {
                        try {
                            const response = await fetch('/api/bookings/');
                            if (response.ok) {
                                const bookings = await response.json();
                                displayBookings(bookings);
                            } else {
                                console.error('Error loading bookings');
                                alert('Failed to load bookings.');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error loading bookings.');
                        }
                    }

                    // Display bookings in table
                    function displayBookings(bookings) {
                        const tbody = document.getElementById('bookings-tbody');
                        tbody.innerHTML = '';

                        bookings.forEach(booking => {
                            const row = document.createElement('tr');
                            row.dataset.bookingId = booking._id;

                            // Format date and time
                            const dateTime = `${booking.date} ${booking.time}`;

                            // Status badge class
                            const statusClass = getStatusBadgeClass(booking.status);

                            row.innerHTML = `
            <td>#${booking._id.slice(-6)}</td>
            <td>${booking.customer_name}</td>
            <td>${dateTime}</td>
            <td>${booking.guests}</td>
            <td><span class="badge ${statusClass}">${booking.status}</span></td>
            <td class="text-center">
                <button class="btn btn-icon btn-sm btn-primary-custom me-1 edit-booking-btn" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-icon btn-sm btn-danger-custom delete-booking-btn" title="Delete">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        `;
                            tbody.appendChild(row);
                        });
                    }

                    // Edit booking
                    async function editBooking(bookingId) {
                        try {
                            const response = await fetch(`/api/bookings/${bookingId}/`);
                            if (response.ok) {
                                const booking = await response.json();

                                // Populate form with booking data
                                currentBookingId = bookingId;
                                document.getElementById('bookingModalLabel').textContent = 'Edit Booking';
                                document.getElementById('bookingCustomerName').value = booking.customer_name;
                                document.getElementById('bookingCustomerPhone').value = booking.phone;
                                document.getElementById('bookingDate').value = booking.date;
                                document.getElementById('bookingTime').value = booking.time;
                                document.getElementById('bookingGuests').value = booking.guests;
                                document.getElementById('bookingStatus').value = booking.status;

                                // Show modal
                                const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
                                modal.show();
                            } else {
                                alert('Error loading booking details');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error loading booking details');
                        }
                    }

                    // Delete booking
                    async function deleteBooking(bookingId) {
                        if (confirm('Are you sure you want to delete this booking?')) {
                            try {
                                const response = await fetch(`/api/bookings/${bookingId}/`, {
                                    method: 'DELETE',
                                    headers: {
                                        'X-CSRFToken': getCookie('csrftoken')
                                    }
                                });

                                if (response.ok) {
                                    alert('Booking deleted successfully');
                                    loadAllBookings();
                                } else {
                                    alert('Error deleting booking');
                                }
                            } catch (error) {
                                console.error('Error:', error);
                                alert('Error deleting booking');
                            }
                        }
                    }

                    // Get status badge class (reuse from order management)
                    function getStatusBadgeClass(status) {
                        switch (status) {
                            case 'Pending':
                                return 'status-pending';
                            case 'Confirmed':
                                return 'status-confirmed';
                            case 'Cancelled':
                                return 'status-cancelled';
                            default:
                                return 'bg-secondary';
                        }
                    }

                    // Get CSRF token (reuse from existing code)
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                    const closeModalButtons = document.querySelectorAll('[data-bs-dismiss="modal"]');
                    closeModalButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            location.reload(); // Reload the page when close button is clicked
                        });
                    });
                </script>


                <!-- Menu Management View -->
                <div id="menu-management-view" class="view">
                    <div class="view-header d-flex justify-content-between align-items-center mb-4">
                        <h2>Menu Management</h2>
                        <button type="button" class="btn btn-success btn-add" id="addNewMenuItemBtn"><i
                                class="fas fa-plus-circle me-2"></i>Add Menu Item</button>
                    </div>
                    <div class="card table-card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Item Name</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Availability</th>
                                            <th class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="menu-items-tbody">
                                        <tr>
                                            <td><img src="https://placehold.co/60x60/1abc9c/white?text=B"
                                                    class="menu-item-image" alt="Burger"></td>
                                            <td>Classic Burger</td>
                                            <td>Main Course</td>
                                            <td>$12.50</td>
                                            <td><span class="badge bg-success-custom">Available</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-menu-item-btn"><i
                                                        class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-menu-item-btn"><i
                                                        class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                        <tr>
                                            <td><img src="https://placehold.co/60x60/3498db/white?text=S"
                                                    class="menu-item-image" alt="Salad"></td>
                                            <td>Caesar Salad</td>
                                            <td>Appetizers</td>
                                            <td>$8.00</td>
                                            <td><span class="badge bg-success-custom">Available</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-menu-item-btn"><i
                                                        class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-menu-item-btn"><i
                                                        class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                        <tr>
                                            <td><img src="https://placehold.co/60x60/e74c3c/white?text=T"
                                                    class="menu-item-image" alt="Tiramisu"></td>
                                            <td>Tiramisu</td>
                                            <td>Desserts</td>
                                            <td>$7.50</td>
                                            <td><span class="badge bg-secondary-custom">Unavailable</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-menu-item-btn"><i
                                                        class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-menu-item-btn"><i
                                                        class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="menuItemModal" tabindex="-1" aria-labelledby="menuItemModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="menuItemModalLabel">Menu Item Details</h5><button
                                        type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="menuItemForm"><input type="hidden" id="menuItemId">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="row">
                                                    <div class="col-md-7 mb-3"><label for="menuItemName"
                                                            class="form-label">Item Name</label><input type="text"
                                                            class="form-control" id="menuItemName" required></div>
                                                    <div class="col-md-5 mb-3"><label for="menuItemPrice"
                                                            class="form-label">Price</label><input type="number"
                                                            step="0.01" min="0" class="form-control" id="menuItemPrice"
                                                            required></div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-7 mb-3"><label for="menuItemCategory"
                                                            class="form-label">Category</label><select
                                                            id="menuItemCategory" class="form-select" required>
                                                            <option>Main Course</option>
                                                            <option>Appetizers</option>
                                                            <option>Desserts</option>
                                                            <option>Beverages</option>
                                                        </select></div>
                                                    <div class="col-md-5 mb-3"><label for="menuItemAvailability"
                                                            class="form-label">Availability</label><select
                                                            id="menuItemAvailability" class="form-select">
                                                            <option value="Available">Available</option>
                                                            <option value="Unavailable">Unavailable</option>
                                                        </select></div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-3"><label for="menuItemImage"
                                                    class="form-label">Image</label><input class="form-control"
                                                    type="file" id="menuItemImage" accept="image/*">
                                                <div class="mt-2"><img id="menuItemImagePreview"
                                                        src="https://placehold.co/200x200/cccccc/969696?text=Image"
                                                        alt="Image Preview" class="img-fluid rounded"></div>
                                            </div>
                                        </div>
                                        <div class="mb-3"><label for="menuItemDescription"
                                                class="form-label">Description</label><textarea class="form-control"
                                                id="menuItemDescription" rows="3"></textarea></div>
                                    </form>
                                </div>
                                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button><button type="submit" form="menuItemForm"
                                        class="btn btn-primary-custom" id="saveMenuItemBtn">Save Changes</button></div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    // Menu management variables
                    let currentMenuItemId = null;

                    // Initialize page
                    document.addEventListener('DOMContentLoaded', function () {
                        loadAllMenuItems();

                        // Add event listeners
                        const addNewMenuItemBtn = document.getElementById('addNewMenuItemBtn');
                        const saveMenuItemBtn = document.getElementById('saveMenuItemBtn');
                        const menuItemsTbody = document.getElementById('menu-items-tbody');
                        const menuItemImage = document.getElementById('menuItemImage');

                        if (addNewMenuItemBtn) {
                            addNewMenuItemBtn.addEventListener('click', openNewMenuItemModal);
                        } else {
                            console.error('Add New Menu Item button not found');
                        }

                        if (saveMenuItemBtn) {
                            saveMenuItemBtn.addEventListener('click', saveMenuItem);
                        } else {
                            console.error('Save Menu Item button not found');
                        }

                        // Add event listener for modal close button
                        const closeModalButtons = document.querySelectorAll('[data-bs-dismiss="modal"]');
                        closeModalButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                location.reload(); // Reload the page when close button is clicked
                            });
                        });


                        // Add event listeners for edit and delete buttons
                        if (menuItemsTbody) {
                            menuItemsTbody.addEventListener('click', function (e) {
                                if (e.target.closest('.edit-menu-item-btn')) {
                                    const itemId = e.target.closest('tr').dataset.itemId;
                                    editMenuItem(itemId);
                                } else if (e.target.closest('.delete-menu-item-btn')) {
                                    const itemId = e.target.closest('tr').dataset.itemId;
                                    deleteMenuItem(itemId);
                                }
                            });
                        } else {
                            console.error('Menu items table body not found');
                        }

                        // Image preview handler
                        if (menuItemImage) {
                            menuItemImage.addEventListener('change', function (e) {
                                const file = e.target.files[0];
                                if (file) {
                                    const reader = new FileReader();
                                    reader.onload = function (event) {
                                        document.getElementById('menuItemImagePreview').src = event.target.result;
                                    };
                                    reader.onerror = function (error) {
                                        console.error('Error reading image file:', error);
                                        alert('Error reading image file.');
                                        document.getElementById('menuItemImagePreview').src = 'https://placehold.co/200x200/cccccc/969696?text=Image';
                                    };
                                    reader.readAsDataURL(file);
                                } else {
                                    document.getElementById('menuItemImagePreview').src = 'https://placehold.co/200x200/cccccc/969696?text=Image';
                                }
                            });
                        } else {
                            console.error('Menu item image input not found');
                        }
                    });

                    // Open new menu item modal
                    function openNewMenuItemModal() {
                        currentMenuItemId = null;
                        const modalLabel = document.getElementById('menuItemModalLabel');
                        const form = document.getElementById('menuItemForm');
                        const imagePreview = document.getElementById('menuItemImagePreview');
                        const imageInput = document.getElementById('menuItemImage');

                        if (modalLabel && form && imagePreview && imageInput) {
                            modalLabel.textContent = 'Create New Menu Item';
                            form.reset();
                            imagePreview.src = 'https://placehold.co/200x200/cccccc/969696?text=Image';
                            imageInput.value = '';
                            const modal = new bootstrap.Modal(document.getElementById('menuItemModal'));
                            modal.show();
                        } else {
                            console.error('Required modal elements not found');
                            alert('Error opening modal: Form elements missing.');
                        }
                    }

                    // Save menu item (Create or Update)
                    async function saveMenuItem(e) {
                        e.preventDefault(); // Prevent default form submission

                        const name = document.getElementById('menuItemName')?.value.trim();
                        const price = document.getElementById('menuItemPrice')?.value;
                        const category = document.getElementById('menuItemCategory')?.value;
                        const availability = document.getElementById('menuItemAvailability')?.value;
                        const description = document.getElementById('menuItemDescription')?.value.trim();
                        const imageFile = document.getElementById('menuItemImage')?.files[0];

                        // Validate form inputs
                        if (!name || !price || !category || !availability) {
                            alert('Please fill out all required fields.');
                            console.error('Validation failed: Missing required fields', { name, price, category, availability });
                            return;
                        }

                        if (isNaN(price) || parseFloat(price) < 0) {
                            alert('Price must be a non-negative number.');
                            console.error('Validation failed: Invalid price', { price });
                            return;
                        }

                        const formData = new FormData();
                        const data = {
                            name: name,
                            price: parseFloat(price),
                            category: category,
                            availability: availability,
                            description: description
                        };
                        formData.append('data', JSON.stringify(data));
                        if (imageFile) {
                            // Validate image file size (max 2MB)
                            if (imageFile.size > 2 * 1024 * 1024) {
                                alert('Image file too large (max 2MB).');
                                console.error('Validation failed: Image file too large', { size: imageFile.size });
                                return;
                            }
                            formData.append('image', imageFile);
                        }

                        try {
                            let response;
                            const headers = {
                                'X-CSRFToken': getCookie('csrftoken')
                            };

                            if (currentMenuItemId) {
                                // Update existing menu item
                                response = await fetch(`/api/menu-items/${currentMenuItemId}/`, {
                                    method: 'PUT',
                                    headers: headers,
                                    body: formData
                                });
                            } else {
                                // Create new menu item
                                response = await fetch('/api/menu-items/', {
                                    method: 'POST',
                                    headers: headers,
                                    body: formData
                                });
                            }

                            const result = await response.json();
                            if (response.ok) {
                                alert(currentMenuItemId ? 'Menu item updated successfully!' : 'Menu item created successfully!');
                                console.log('Menu item saved:', result);
                                const modal = bootstrap.Modal.getInstance(document.getElementById('menuItemModal'));
                                modal.hide();
                                loadAllMenuItems(); // Refresh table without full page reload
                                location.reload();
                            } else {
                                console.error('Error saving menu item:', result);
                                alert('Error saving menu item: ' + (result.error || result.message || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error saving menu item:', error);
                            alert('Error saving menu item. Please check your network or try again.');
                        }
                    }

                    // Load all menu items
                    async function loadAllMenuItems() {
                        try {
                            const response = await fetch('/api/menu-items/');
                            if (response.ok) {
                                const items = await response.json();
                                console.log('Menu items loaded:', items);
                                displayMenuItems(items);
                            } else {
                                const error = await response.json();
                                console.error('Error loading menu items:', error);
                                alert('Failed to load menu items: ' + (error.error || error.message || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error loading menu items:', error);
                            alert('Error loading menu items. Please check your network or try again.');
                        }
                    }

                    // Display menu items in table
                    function displayMenuItems(items) {
                        const tbody = document.getElementById('menu-items-tbody');
                        if (!tbody) {
                            console.error('Menu items table body not found');
                            alert('Error: Menu items table not found.');
                            return;
                        }
                        tbody.innerHTML = '';

                        items.forEach(item => {
                            const row = document.createElement('tr');
                            row.dataset.itemId = item._id;

                            const availabilityClass = item.availability === 'Available' ? 'bg-success-custom' : 'bg-secondary-custom';

                            // Ensure image has a fallback for invalid URLs
                            row.innerHTML = `
            <td><img src="${item.image}" class="menu-item-image" alt="${item.name}" onerror="this.src='https://placehold.co/60x60/cccccc/969696?text=Error'"></td>
            <td>${item.name}</td>
            <td>${item.category}</td>
            <td>$${parseFloat(item.price).toFixed(2)}</td>
            <td><span class="badge ${availabilityClass}">${item.availability}</span></td>
            <td class="text-center">
                <button class="btn btn-icon btn-sm btn-primary-custom me-1 edit-menu-item-btn" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-icon btn-sm btn-danger-custom delete-menu-item-btn" title="Delete">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        `;
                            tbody.appendChild(row);
                        });
                    }

                    // Edit menu item
                    async function editMenuItem(itemId) {
                        try {
                            const response = await fetch(`/api/menu-items/${itemId}/`);
                            if (response.ok) {
                                const item = await response.json();
                                currentMenuItemId = itemId;
                                const modalLabel = document.getElementById('menuItemModalLabel');
                                const nameInput = document.getElementById('menuItemName');
                                const priceInput = document.getElementById('menuItemPrice');
                                const categoryInput = document.getElementById('menuItemCategory');
                                const availabilityInput = document.getElementById('menuItemAvailability');
                                const descriptionInput = document.getElementById('menuItemDescription');
                                const imagePreview = document.getElementById('menuItemImagePreview');
                                const imageInput = document.getElementById('menuItemImage');

                                if (modalLabel && nameInput && priceInput && categoryInput && availabilityInput && descriptionInput && imagePreview && imageInput) {
                                    modalLabel.textContent = 'Edit Menu Item';
                                    nameInput.value = item.name;
                                    priceInput.value = item.price;
                                    categoryInput.value = item.category;
                                    availabilityInput.value = item.availability;
                                    descriptionInput.value = item.description;
                                    imagePreview.src = item.image;
                                    imageInput.value = ''; // Clear file input
                                    const modal = new bootstrap.Modal(document.getElementById('menuItemModal'));
                                    modal.show();
                                } else {
                                    console.error('Required form elements not found for edit');
                                    alert('Error opening edit modal: Form elements missing.');
                                }
                            } else {
                                const error = await response.json();
                                console.error('Error loading menu item:', error);
                                alert('Error loading menu item details: ' + (error.error || error.message || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error loading menu item:', error);
                            alert('Error loading menu item details. Please check your network or try again.');
                        }
                    }

                    // Delete menu item
                    async function deleteMenuItem(itemId) {
                        if (confirm('Are you sure you want to delete this menu item?')) {
                            try {
                                const response = await fetch(`/api/menu-items/${itemId}/`, {
                                    method: 'DELETE',
                                    headers: {
                                        'X-CSRFToken': getCookie('csrftoken')
                                    }
                                });
                                if (response.ok) {
                                    alert('Menu item deleted successfully');
                                    console.log('Menu item deleted:', itemId);
                                    loadAllMenuItems();
                                } else {
                                    const error = await response.json();
                                    console.error('Error deleting menu item:', error);
                                    alert('Error deleting menu item: ' + (error.error || error.message || 'Unknown error'));
                                }
                            } catch (error) {
                                console.error('Error deleting menu item:', error);
                                alert('Error deleting menu item. Please check your network or try again.');
                            }
                        }
                    }

                    // Get CSRF token
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        if (!cookieValue) {
                            console.error('CSRF token not found');
                        }
                        return cookieValue;
                    }
                </script>

                <!-- Delivery Management View -->
                <div id="delivery-management-view" class="view">
                    <div class="view-header d-flex justify-content-between align-items-center mb-4">
                        <h2>Delivery Management</h2>
                        <button type="button" class="btn btn-success btn-add" id="addNewDeliveryBtn"><i
                                class="fas fa-plus-circle me-2"></i>Add New Delivery</button>
                    </div>
                    <div class="card table-card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Address</th>
                                            <th>Driver</th>
                                            <th>Status</th>
                                            <th class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="delivery-tbody">
                                        <tr data-delivery-id="D-55">
                                            <td>#101</td>
                                            <td>John Doe</td>
                                            <td>123 Main St...</td>
                                            <td>Mike</td>
                                            <td><span class="badge status-out-for-delivery">Out for Delivery</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-delivery-btn"><i
                                                        class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-delivery-btn"><i
                                                        class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                        <tr data-delivery-id="D-56">
                                            <td>#103</td>
                                            <td>Alice</td>
                                            <td>456 Oak Ave...</td>
                                            <td>Unassigned</td>
                                            <td><span class="badge status-ready-for-pickup">Ready for Pickup</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-delivery-btn"><i
                                                        class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-delivery-btn"><i
                                                        class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                        <tr data-delivery-id="D-54">
                                            <td>#99</td>
                                            <td>Bob</td>
                                            <td>789 Pine Ln...</td>
                                            <td>Sarah</td>
                                            <td><span class="badge status-delivered">Delivered</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-delivery-btn"><i
                                                        class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-delivery-btn"><i
                                                        class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Delivery Modal -->
                    <div class="modal fade" id="deliveryModal" tabindex="-1" aria-labelledby="deliveryModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deliveryModalLabel">Delivery Details</h5><button
                                        type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="deliveryForm"><input type="hidden" id="deliveryId" name="deliveryId">
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="deliveryOrderId"
                                                    class="form-label">Order ID</label><input type="text"
                                                    class="form-control" id="deliveryOrderId" required></div>
                                            <div class="col-md-6 mb-3"><label for="deliveryCustomerName"
                                                    class="form-label">Customer Name</label><input type="text"
                                                    class="form-control" id="deliveryCustomerName" required></div>
                                        </div>
                                        <div class="mb-3"><label for="deliveryAddress"
                                                class="form-label">Address</label><input type="text"
                                                class="form-control" id="deliveryAddress" required></div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="deliveryDriver"
                                                    class="form-label">Driver</label><input type="text"
                                                    class="form-control" id="deliveryDriver"
                                                    placeholder="e.g., Mike, Sarah, or Unassigned"></div>
                                            <div class="col-md-6 mb-3"><label for="deliveryStatus"
                                                    class="form-label">Status</label><select id="deliveryStatus"
                                                    class="form-select" required>
                                                    <option value="Ready for Pickup">Ready for Pickup</option>
                                                    <option value="Out for Delivery">Out for Delivery</option>
                                                    <option value="Delivered">Delivered</option>
                                                    <option value="Cancelled">Cancelled</option>
                                                </select></div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button><button type="submit" form="deliveryForm"
                                        class="btn btn-primary-custom" id="saveDeliveryBtn">Save Changes</button></div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    // Delivery management variables
                    let currentDeliveryId = null;

                    // Initialize page
                    document.addEventListener('DOMContentLoaded', function () {
                        loadAllDeliveries();

                        // Add event listeners
                        const addNewDeliveryBtn = document.getElementById('addNewDeliveryBtn');
                        const saveDeliveryBtn = document.getElementById('saveDeliveryBtn');
                        const deliveryTbody = document.getElementById('delivery-tbody');

                        if (addNewDeliveryBtn) {
                            addNewDeliveryBtn.addEventListener('click', openNewDeliveryModal);
                        } else {
                            console.error('Add New Delivery button not found');
                        }

                        if (saveDeliveryBtn) {
                            saveDeliveryBtn.addEventListener('click', saveDelivery);
                        } else {
                            console.error('Save Delivery button not found');
                        }

                        // Add event listener for modal close button
                        const closeModalButtons = document.querySelectorAll('#deliveryModal [data-bs-dismiss="modal"]');
                        closeModalButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                // Reset form and close modal without reloading
                                const form = document.getElementById('deliveryForm');
                                if (form) {
                                    form.reset();
                                    document.getElementById('deliveryId').value = '';
                                }
                            });
                        });

                        // Add event listeners for edit and delete buttons
                        if (deliveryTbody) {
                            deliveryTbody.addEventListener('click', function (e) {
                                if (e.target.closest('.edit-delivery-btn')) {
                                    const deliveryId = e.target.closest('tr').dataset.deliveryId;
                                    editDelivery(deliveryId);

                                } else if (e.target.closest('.delete-delivery-btn')) {
                                    const deliveryId = e.target.closest('tr').dataset.deliveryId;
                                    deleteDelivery(deliveryId);

                                }
                            });
                        } else {
                            console.error('Delivery table body not found');
                        }
                    });

                    // Open new delivery modal
                    function openNewDeliveryModal() {
                        currentDeliveryId = null;
                        const modalLabel = document.getElementById('deliveryModalLabel');
                        const form = document.getElementById('deliveryForm');
                        const deliveryIdInput = document.getElementById('deliveryId');

                        if (modalLabel && form && deliveryIdInput) {
                            modalLabel.textContent = 'Create New Delivery';
                            form.reset();
                            deliveryIdInput.value = '';
                            const modal = new bootstrap.Modal(document.getElementById('deliveryModal'));
                            modal.show();
                        } else {
                            console.error('Required modal elements not found');
                            alert('Error opening modal: Form elements missing.');
                        }
                    }

                    // Save delivery (Create or Update)
                    async function saveDelivery(e) {
                        e.preventDefault(); // Prevent default form submission

                        const orderId = document.getElementById('deliveryOrderId')?.value.trim();
                        const customerName = document.getElementById('deliveryCustomerName')?.value.trim();
                        const address = document.getElementById('deliveryAddress')?.value.trim();
                        const driver = document.getElementById('deliveryDriver')?.value.trim();
                        const status = document.getElementById('deliveryStatus')?.value;

                        // Validate form inputs
                        if (!orderId || !customerName || !address || !driver || !status) {
                            alert('Please fill out all required fields.');
                            console.error('Validation failed: Missing required fields', { orderId, customerName, address, driver, status });
                            return;
                        }

                        const data = {
                            order_id: orderId,
                            customer_name: customerName,
                            address: address,
                            driver: driver,
                            status: status
                        };

                        try {
                            let response;
                            const headers = {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCookie('csrftoken')
                            };

                            if (currentDeliveryId) {
                                // Update existing delivery
                                response = await fetch(`/api/deliveries/${currentDeliveryId}/`, {
                                    method: 'PUT',
                                    headers: headers,
                                    body: JSON.stringify(data)
                                });
                            } else {
                                // Create new delivery
                                response = await fetch('/api/deliveries/', {
                                    method: 'POST',
                                    headers: headers,
                                    body: JSON.stringify(data)
                                });
                            }

                            const result = await response.json();
                            if (response.ok) {
                                alert(currentDeliveryId ? 'Delivery updated successfully!' : 'Delivery created successfully!');
                                console.log('Delivery saved:', result);
                                const modal = bootstrap.Modal.getInstance(document.getElementById('deliveryModal'));
                                modal.hide();
                                loadAllDeliveries(); // Refresh table without full page reload
                                location.reload();
                            } else {
                                console.error('Error saving delivery:', result);
                                alert('Error saving delivery: ' + (result.error || result.message || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error saving delivery:', error);
                            alert('Error saving delivery. Please check your network or try again.');
                        }
                    }

                    // Load all deliveries
                    async function loadAllDeliveries() {
                        try {
                            const response = await fetch('/api/deliveries/');
                            if (response.ok) {
                                const deliveries = await response.json();
                                console.log('Deliveries loaded:', deliveries);
                                displayDeliveries(deliveries);
                            } else {
                                const error = await response.json();
                                console.error('Error loading deliveries:', error);
                                alert('Failed to load deliveries: ' + (error.error || error.message || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error loading deliveries:', error);
                            alert('Error loading deliveries. Please check your network or try again.');
                        }
                    }

                    // Display deliveries in table
                    function displayDeliveries(deliveries) {
                        const tbody = document.getElementById('delivery-tbody');
                        if (!tbody) {
                            console.error('Delivery table body not found');
                            alert('Error: Delivery table not found.');
                            return;
                        }
                        tbody.innerHTML = '';

                        deliveries.forEach(delivery => {
                            const row = document.createElement('tr');
                            row.dataset.deliveryId = delivery._id;

                            // Map status to badge class
                            const statusClassMap = {
                                'Ready for Pickup': 'status-ready-for-pickup',
                                'Out for Delivery': 'status-out-for-delivery',
                                'Delivered': 'status-delivered',
                                'Cancelled': 'status-cancelled'
                            };
                            const statusClass = statusClassMap[delivery.status] || 'status-cancelled';

                            // Truncate address for display
                            const truncatedAddress = delivery.address.length > 20 ? delivery.address.substring(0, 20) + '...' : delivery.address;

                            row.innerHTML = `
            <td>${delivery.order_id}</td>
            <td>${delivery.customer_name}</td>
            <td>${truncatedAddress}</td>
            <td>${delivery.driver}</td>
            <td><span class="badge ${statusClass}">${delivery.status}</span></td>
            <td class="text-center">
                <button class="btn btn-icon btn-sm btn-primary-custom me-1 edit-delivery-btn" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-icon btn-sm btn-danger-custom delete-delivery-btn" title="Delete">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        `;
                            tbody.appendChild(row);
                        });
                    }

                    // Edit delivery
                    async function editDelivery(deliveryId) {
                        try {
                            const response = await fetch(`/api/deliveries/${deliveryId}/`);
                            if (response.ok) {
                                const delivery = await response.json();
                                currentDeliveryId = deliveryId;
                                const modalLabel = document.getElementById('deliveryModalLabel');
                                const orderIdInput = document.getElementById('deliveryOrderId');
                                const customerNameInput = document.getElementById('deliveryCustomerName');
                                const addressInput = document.getElementById('deliveryAddress');
                                const driverInput = document.getElementById('deliveryDriver');
                                const statusInput = document.getElementById('deliveryStatus');
                                const deliveryIdInput = document.getElementById('deliveryId');

                                if (modalLabel && orderIdInput && customerNameInput && addressInput && driverInput && statusInput && deliveryIdInput) {
                                    modalLabel.textContent = 'Edit Delivery';
                                    orderIdInput.value = delivery.order_id;
                                    customerNameInput.value = delivery.customer_name;
                                    addressInput.value = delivery.address;
                                    driverInput.value = delivery.driver;
                                    statusInput.value = delivery.status;
                                    deliveryIdInput.value = delivery._id;
                                    const modal = new bootstrap.Modal(document.getElementById('deliveryModal'));
                                    modal.show();
                                } else {
                                    console.error('Required form elements not found for edit');
                                    alert('Error opening edit modal: Form elements missing.');
                                }
                            } else {
                                const error = await response.json();
                                console.error('Error loading delivery:', error);
                                alert('Error loading delivery details: ' + (error.error || error.message || 'Unknown error'));
                            }
                        } catch (error) {
                            console.error('Error loading delivery:', error);
                            alert('Error loading delivery details. Please check your network or try again.');
                        }
                    }

                    // Delete delivery
                    async function deleteDelivery(deliveryId) {
                        if (confirm('Are you sure you want to delete this delivery?')) {
                            try {
                                const response = await fetch(`/api/deliveries/${deliveryId}/`, {
                                    method: 'DELETE',
                                    headers: {
                                        'X-CSRFToken': getCookie('csrftoken')
                                    }
                                });
                                if (response.ok) {
                                    alert('Delivery deleted successfully');
                                    console.log('Delivery deleted:', deliveryId);
                                    loadAllDeliveries();
                                } else {
                                    const error = await response.json();
                                    console.error('Error deleting delivery:', error);
                                    alert('Error deleting delivery: ' + (error.error || error.message || 'Unknown error'));
                                }
                            } catch (error) {
                                console.error('Error deleting delivery:', error);
                                alert('Error deleting delivery. Please check your network or try again.');
                            }
                        }
                    }

                    // Get CSRF token
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        if (!cookieValue) {
                            console.error('CSRF token not found');
                        }
                        return cookieValue;
                    }
                </script>

                

                <!-- Invoice Management View -->
                <div id="invoice-management-view" class="view">
                    <div class="view-header d-flex justify-content-between align-items-center mb-4">
                        <h2>Invoice Management</h2>
                        <button type="button" class="btn btn-success btn-add" id="generateInvoiceBtn"><i
                                class="fas fa-plus-circle me-2"></i>Generate Invoice</button>
                    </div>
                    <div class="card table-card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Invoice #</th>
                                            <th>Customer</th>
                                            <th>Date</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="invoices-tbody">
                                        <!-- Populated dynamically by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Invoice Modal (Create/Edit) -->
                    <div class="modal fade" id="invoiceModal" tabindex="-1" aria-labelledby="invoiceModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="invoiceModalLabel">Generate Invoice</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="invoiceForm">
                                        <input type="hidden" id="invoiceId" name="invoiceId">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="invoiceCustomerName" class="form-label">Customer
                                                    Name</label>
                                                <input type="text" class="form-control" id="invoiceCustomerName"
                                                    required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="invoiceDate" class="form-label">Date</label>
                                                <input type="date" class="form-control" id="invoiceDate" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="invoiceAmount" class="form-label">Amount ($)</label>
                                                <input type="number" step="0.01" class="form-control" id="invoiceAmount"
                                                    required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="invoiceStatus" class="form-label">Status</label>
                                                <select id="invoiceStatus" class="form-select" required>
                                                    <option value="Paid">Paid</option>
                                                    <option value="Unpaid">Unpaid</option>
                                                </select>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button type="submit" form="invoiceForm" class="btn btn-primary-custom"
                                        id="saveInvoiceBtn">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Invoice View Modal -->
                    <div class="modal fade" id="invoiceViewModal" tabindex="-1" aria-labelledby="invoiceViewModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="invoiceViewModalLabel">Invoice Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body" id="invoiceViewModalBody">
                                    <!-- Populated dynamically by JavaScript -->
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
<script>
    // Invoice management variables
    let currentInvoiceId = null;

    // Initialize page for invoices
    document.addEventListener('DOMContentLoaded', function () {
        loadAllInvoices();

        // Add event listeners
        document.getElementById('generateInvoiceBtn').addEventListener('click', openNewInvoiceModal);
        document.getElementById('saveInvoiceBtn').addEventListener('click', saveInvoice);

        // Event delegation for edit, delete, view buttons
        document.getElementById('invoices-tbody').addEventListener('click', function (e) {
            if (e.target.closest('.edit-invoice-btn')) {
                const invoiceId = e.target.closest('tr').dataset.invoiceId;
                editInvoice(invoiceId);
            } else if (e.target.closest('.delete-invoice-btn')) {
                const invoiceId = e.target.closest('tr').dataset.invoiceId;
                deleteInvoice(invoiceId);
            } else if (e.target.closest('.view-invoice-btn')) {
                const invoiceId = e.target.closest('tr').dataset.invoiceId;
                viewInvoice(invoiceId);
            }
        });
    });

    // Open new invoice modal
    function openNewInvoiceModal() {
        currentInvoiceId = null;
        document.getElementById('invoiceModalLabel').textContent = 'Generate Invoice';
        document.getElementById('invoiceForm').reset();
        const modal = new bootstrap.Modal(document.getElementById('invoiceModal'));
        modal.show();
    }

    // Save invoice (Create or Update)
    async function saveInvoice() {
        const customerName = document.getElementById('invoiceCustomerName').value.trim();
        const date = document.getElementById('invoiceDate').value;
        const amount = document.getElementById('invoiceAmount').value;
        const status = document.getElementById('invoiceStatus').value;

        if (!customerName || !date || !amount || !status) {
            alert('Please fill out all fields.');
            return;
        }

        if (isNaN(amount) || parseFloat(amount) < 0) {
            alert('Amount must be a non-negative number.');
            return;
        }

        const invoiceData = {
            customer_name: customerName,
            date: date,
            amount: parseFloat(amount).toFixed(2),
            status: status
        };

        try {
            let response;
            if (currentInvoiceId) {
                // Update existing invoice
                response = await fetch(`/api/invoices/${currentInvoiceId}/`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify(invoiceData)
                });
            } else {
                // Create new invoice
                response = await fetch('/api/invoices/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify(invoiceData)
                });
            }

            if (response.ok) {
                const result = await response.json();
                alert(currentInvoiceId ? 'Invoice updated successfully!' : 'Invoice created successfully!');
                const modal = bootstrap.Modal.getInstance(document.getElementById('invoiceModal'));
                modal.hide();
                loadAllInvoices();
            } else {
                const error = await response.json();
                alert('Error saving invoice: ' + (error.error || 'Unknown error'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error saving invoice. Please try again.');
        }
    }

    // Load all invoices
    async function loadAllInvoices() {
        try {
            const response = await fetch('/api/invoices/');
            if (response.ok) {
                const invoices = await response.json();
                displayInvoices(invoices);
            } else {
                console.error('Error loading invoices');
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // Display invoices in table
    function displayInvoices(invoices) {
        const tbody = document.getElementById('invoices-tbody');
        tbody.innerHTML = '';

        invoices.forEach(invoice => {
            const row = document.createElement('tr');
            row.dataset.invoiceId = invoice._id;

            const statusClass = invoice.status === 'Paid' ? 'bg-success' : 'bg-danger';

            row.innerHTML = `
                <td>#${invoice._id.slice(-6)}</td>
                <td>${invoice.customer_name}</td>
                <td>${invoice.date}</td>
                <td>$${invoice.amount}</td>
                <td><span class="badge ${statusClass}">${invoice.status}</span></td>
                <td class="text-center">
                    <button class="btn btn-icon btn-sm btn-primary-custom me-1 edit-invoice-btn" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-icon btn-sm btn-info me-1 view-invoice-btn" title="View">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-icon btn-sm btn-success me-1 download-invoice-btn" onclick="downloadInvoice('${invoice._id}')" title="Download PDF">
                        <i class="fas fa-file-pdf"></i>
                    </button>
                    <button class="btn btn-icon btn-sm btn-danger-custom delete-invoice-btn" title="Delete">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Edit invoice
    async function editInvoice(invoiceId) {
        try {
            const response = await fetch(`/api/invoices/${invoiceId}/`);
            if (response.ok) {
                const invoice = await response.json();
                currentInvoiceId = invoiceId;
                document.getElementById('invoiceModalLabel').textContent = 'Edit Invoice';
                document.getElementById('invoiceCustomerName').value = invoice.customer_name;
                document.getElementById('invoiceDate').value = invoice.date;
                document.getElementById('invoiceAmount').value = invoice.amount;
                document.getElementById('invoiceStatus').value = invoice.status;
                const modal = new bootstrap.Modal(document.getElementById('invoiceModal'));
                modal.show();
            } else {
                alert('Error loading invoice details');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error loading invoice details');
        }
    }

    // Delete invoice
    async function deleteInvoice(invoiceId) {
        if (confirm('Are you sure you want to delete this invoice?')) {
            try {
                const response = await fetch(`/api/invoices/${invoiceId}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                });
                if (response.ok) {
                    alert('Invoice deleted successfully');
                    loadAllInvoices();
                } else {
                    alert('Error deleting invoice');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting invoice');
            }
        }
    }

    // View invoice
    async function viewInvoice(invoiceId) {
        try {
            const response = await fetch(`/api/invoices/${invoiceId}/`);
            if (response.ok) {
                const invoice = await response.json();
                const body = document.getElementById('invoiceViewModalBody');
                body.innerHTML = `
                    <p><strong>Invoice #:</strong> #${invoice._id.slice(-6)}</p>
                    <p><strong>Customer:</strong> ${invoice.customer_name}</p>
                    <p><strong>Date:</strong> ${invoice.date}</p>
                    <p><strong>Amount:</strong> $${invoice.amount}</p>
                    <p><strong>Status:</strong> ${invoice.status}</p>
                `;
                const modal = new bootstrap.Modal(document.getElementById('invoiceViewModal'));
                modal.show();
            } else {
                alert('Error loading invoice details');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error loading invoice details');
        }
    }

    // Download invoice PDF
    function downloadInvoice(invoiceId) {
        window.open(`/api/invoices/${invoiceId}/pdf/`, '_blank');
    }

    // Get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

                <!-- Sales Reports View -->
          <div id="sales-reports-view" class="view">
            <h2>Sales Reports</h2>
            <p>Analyze sales performance over selected periods.</p>
            <div class="card report-controls-card mb-4">
              <div class="card-body">
                <form class="row g-3 align-items-end">
                  <div class="col-md-4">
                    <label for="report-start-date" class="form-label"
                      >Start Date</label
                    >
                    <input
                      type="date"
                      id="report-start-date"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-4">
                    <label for="report-end-date" class="form-label"
                      >End Date</label
                    >
                    <input
                      type="date"
                      id="report-end-date"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-4">
                    <button
                      type="button"
                      id="generate-report-btn"
                      class="btn btn-primary-custom w-100"
                    >
                      <i class="fas fa-sync-alt me-2"></i>Generate Report
                    </button>
                  </div>
                </form>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-12">
                <div class="card chart-container-wrapper">
                  <div class="card-header">Sales Over Time</div>
                  <div class="card-body">
                    <div
                      class="chart-container"
                      style="min-height: 350px; max-width: 100%"
                    >
                      <canvas id="salesBarChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

<script>
    // Add this script for sales reports
    let salesChart;

    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the chart
        const salesBarChartCtx = document.getElementById('salesBarChart').getContext('2d');
        salesChart = new Chart(salesBarChartCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Sales',
                    data: [],
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Generate report button
        document.getElementById('generate-report-btn').addEventListener('click', generateSalesReport);

        // Load initial report, e.g., last 30 days
        generateSalesReport();
    });

    async function generateSalesReport() {
        const startDate = document.getElementById('report-start-date').value;
        const endDate = document.getElementById('report-end-date').value;

        let url = '/api/sales_report/';
        if (startDate || endDate) {
            url += '?';
            if (startDate) url += `start=${startDate}&`;
            if (endDate) url += `end=${endDate}`;
        }

        try {
            const response = await fetch(url);
            if (response.ok) {
                const data = await response.json();
                updateSalesChart(data);
            } else {
                alert('Error loading sales data');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error loading sales data');
        }
    }

    function updateSalesChart(data) {
        salesChart.data.labels = data.labels;
        salesChart.data.datasets[0].data = data.sales;
        salesChart.update();
    }
</script>

                <!-- Customer Analytics Dashboard View -->
          <div id="customer-analytics-view" class="view">
            <h2>Customer Analytics</h2>
            <p>Analyze customer data and behavior.</p>
            <div class="card report-controls-card mb-4">
              <div class="card-body">
                <form class="row g-3 align-items-end">
                  <div class="col-md-4">
                    <label for="customer-start-date" class="form-label"
                      >Start Date</label
                    >
                    <input
                      type="date"
                      id="customer-start-date"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-4">
                    <label for="customer-end-date" class="form-label"
                      >End Date</label
                    >
                    <input
                      type="date"
                      id="customer-end-date"
                      class="form-control"
                    />
                  </div>
                  <div class="col-md-4">
                    <button
                      type="button"
                      id="generate-customer-report-btn"
                      class="btn btn-primary-custom w-100"
                    >
                      <i class="fas fa-sync-alt me-2"></i>Generate Report
                    </button>
                  </div>
                </form>
              </div>
            </div>
            <div class="stats-cards" id="customer-stats-cards">
              <!-- Stats cards will be populated here -->
            </div>
            <div class="row mt-4">
              <div class="col-lg-12">
                <div class="card chart-container-wrapper">
                  <div class="card-header">New Customers Over Time</div>
                  <div class="card-body">
                    <div
                      class="chart-container"
                      style="min-height: 350px; max-width: 100%"
                    >
                      <canvas id="customerGrowthChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

<script>
    // Add this script for customer analytics
    let customerGrowthChart;

    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the chart
        const customerGrowthChartCtx = document.getElementById('customerGrowthChart')?.getContext('2d');
        if (customerGrowthChartCtx) {
            customerGrowthChart = new Chart(customerGrowthChartCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'New Customers',
                        data: [],
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Generate report button
        const generateBtn = document.getElementById('generate-customer-report-btn');
        if (generateBtn) {
            generateBtn.addEventListener('click', generateCustomerReport);
        }

        // Load initial report if the view is active
        if (document.getElementById('customer-analytics-view').classList.contains('active-view')) {
            generateCustomerReport();
        }
    });

    async function generateCustomerReport() {
        const startDate = document.getElementById('customer-start-date').value;
        const endDate = document.getElementById('customer-end-date').value;

        let url = '/api/customer_analytics/';
        if (startDate || endDate) {
            url += '?';
            if (startDate) url += `start=${startDate}&`;
            if (endDate) url += `end=${endDate}`;
        }

        try {
            const response = await fetch(url);
            if (response.ok) {
                const data = await response.json();
                updateCustomerStats(data);
                updateCustomerChart(data);
            } else {
                alert('Error loading customer analytics data');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error loading customer analytics data');
        }
    }

    function updateCustomerStats(data) {
        const statsContainer = document.getElementById('customer-stats-cards');
        statsContainer.innerHTML = `
            <div class="card">
                <h4>Total Customers</h4>
                <p>${data.total_customers}</p>
            </div>
            <div class="card">
                <h4>New Customers</h4>
                <p>${data.new_customers}</p>
            </div>
            <div class="card">
                <h4>Repeat Customers</h4>
                <p>${data.repeat_customers}</p>
            </div>
            <div class="card">
                <h4>Average Spend</h4>
                <p>$${data.average_spend.toFixed(2)}</p>
            </div>
        `;
    }

    function updateCustomerChart(data) {
        customerGrowthChart.data.labels = data.customer_growth.labels;
        customerGrowthChart.data.datasets[0].data = data.customer_growth.values;
        customerGrowthChart.update();
    }
</script>

                <!-- Offers & Discounts View -->
                <div id="offers-discounts-view" class="view">
                    <div class="view-header d-flex justify-content-between align-items-center mb-4">
                        <h2>Offers & Discounts</h2>
                        <button type="button" class="btn btn-success btn-add-offer">
                            <i class="fas fa-plus-circle me-2"></i>Add New Offer
                        </button>
                    </div>
                    <p class="mb-4">Manage your promotional offers, sales, and discount codes to attract and retain
                        customers.</p>
                    <div class="card table-card offers-table-card">
                        <div class="card-header">Current Offers</div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle offers-table mb-0">
                                    <thead>
                                        <tr>
                                            <th>Offer Name</th>
                                            <th>Discount</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Status</th>
                                            <th class="text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="offers-tbody">
                                        <tr data-offer-id="1">
                                            <td>Summer Fiesta Sale</td>
                                            <td>15%</td>
                                            <td>2024-06-01</td>
                                            <td>2024-06-30</td>
                                            <td><span class="badge bg-success-custom">Active</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-offer-btn"
                                                    title="Edit Offer"><i class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-offer-btn"
                                                    title="Delete Offer"><i class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                        <tr data-offer-id="2">
                                            <td>Weekend Bonanza</td>
                                            <td>$5 Off</td>
                                            <td>2024-05-25</td>
                                            <td>2024-05-26</td>
                                            <td><span class="badge bg-secondary-custom">Expired</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-offer-btn"
                                                    title="Edit Offer"><i class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-offer-btn"
                                                    title="Delete Offer"><i class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                        <tr data-offer-id="3">
                                            <td>First Timer's Treat</td>
                                            <td>10%</td>
                                            <td>2024-07-01</td>
                                            <td>2024-12-31</td>
                                            <td><span class="badge status-upcoming">Upcoming</span></td>
                                            <td class="text-center"><button
                                                    class="btn btn-icon btn-sm btn-primary-custom me-1 edit-offer-btn"
                                                    title="Edit Offer"><i class="fas fa-edit"></i></button><button
                                                    class="btn btn-icon btn-sm btn-danger-custom delete-offer-btn"
                                                    title="Delete Offer"><i class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="add-offer-form-container" class="mt-4 card form-card" style="display: none;">
                        <div class="card-header">
                            <h3><i class="fas fa-tag me-2"></i>Add New Offer/Discount</h3>
                        </div>
                        <div class="card-body">
                            <form id="add-offer-form">
                                <div class="row">
                                    <div class="col-md-6 mb-3"><label for="add-offer-name" class="form-label">Offer
                                            Name:</label><input type="text" class="form-control" id="add-offer-name"
                                            name="offerName" required></div>
                                    <div class="col-md-6 mb-3"><label for="add-discount-type"
                                            class="form-label">Discount Type:</label><select class="form-select"
                                            id="add-discount-type" name="discountType">
                                            <option value="Percentage">Percentage (%)</option>
                                            <option value="Fixed Amount">Fixed Amount ($)</option>
                                        </select></div>
                                </div>
                                <div class="mb-3"><label for="add-offer-description"
                                        class="form-label">Description:</label><textarea class="form-control"
                                        id="add-offer-description" name="offerDescription" rows="3"></textarea></div>
                                <div class="row">
                                    <div class="col-md-6 mb-3"><label for="add-discount-value"
                                            class="form-label">Discount Value:</label><input type="number"
                                            class="form-control" id="add-discount-value" name="discountValue" required
                                            step="any" min="0"></div>
                                    <div class="col-md-6 mb-3"><label for="add-offer-status"
                                            class="form-label">Status:</label><select class="form-select"
                                            id="add-offer-status" name="offerStatus">
                                            <option value="Active">Active</option>
                                            <option value="Inactive">Inactive</option>
                                            <option value="Upcoming">Upcoming</option>
                                        </select></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3"><label for="add-start-date" class="form-label">Start
                                            Date:</label><input type="date" class="form-control" id="add-start-date"
                                            name="startDate" required></div>
                                    <div class="col-md-6 mb-3"><label for="add-end-date" class="form-label">End
                                            Date:</label><input type="date" class="form-control" id="add-end-date"
                                            name="endDate" required></div>
                                </div>
                                <div class="d-flex justify-content-end"><button type="button"
                                        class="btn btn-secondary me-2" id="cancel-add-offer-btn">Cancel</button><button
                                        type="submit" class="btn btn-success"><i class="fas fa-save me-2"></i>Save
                                        Offer</button></div>
                            </form>
                        </div>
                    </div>
                    <div class="modal fade" id="editOfferModal" tabindex="-1" aria-labelledby="editOfferModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editOfferModalLabel"><i
                                            class="fas fa-edit me-2"></i>Edit Offer/Discount</h5><button type="button"
                                        class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="edit-offer-form"><input type="hidden" id="edit-offer-id" name="offerId">
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="edit-offer-name"
                                                    class="form-label">Offer Name:</label><input type="text"
                                                    class="form-control" id="edit-offer-name" name="offerName" required>
                                            </div>
                                            <div class="col-md-6 mb-3"><label for="edit-discount-type"
                                                    class="form-label">Discount Type:</label><select class="form-select"
                                                    id="edit-discount-type" name="discountType">
                                                    <option value="Percentage">Percentage (%)</option>
                                                    <option value="Fixed Amount">Fixed Amount ($)</option>
                                                </select></div>
                                        </div>
                                        <div class="mb-3"><label for="edit-offer-description"
                                                class="form-label">Description:</label><textarea class="form-control"
                                                id="edit-offer-description" name="offerDescription" rows="3"></textarea>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="edit-discount-value"
                                                    class="form-label">Discount Value:</label><input type="number"
                                                    class="form-control" id="edit-discount-value" name="discountValue"
                                                    required step="any" min="0"></div>
                                            <div class="col-md-6 mb-3"><label for="edit-offer-status"
                                                    class="form-label">Status:</label><select class="form-select"
                                                    id="edit-offer-status" name="offerStatus">
                                                    <option value="Active">Active</option>
                                                    <option value="Inactive">Inactive</option>
                                                    <option value="Expired">Expired</option>
                                                    <option value="Upcoming">Upcoming</option>
                                                </select></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3"><label for="edit-start-date"
                                                    class="form-label">Start Date:</label><input type="date"
                                                    class="form-control" id="edit-start-date" name="startDate" required>
                                            </div>
                                            <div class="col-md-6 mb-3"><label for="edit-end-date" class="form-label">End
                                                    Date:</label><input type="date" class="form-control"
                                                    id="edit-end-date" name="endDate" required></div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer"><button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button><button type="submit"
                                        form="edit-offer-form" class="btn btn-primary-custom"><i
                                            class="fas fa-save me-2"></i>Update Offer</button></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Feedback View -->
                <div id="customer-feedback-view" class="view">
                    <div class="view-header d-flex justify-content-between align-items-center mb-4">
                        <h2>Customer Feedback</h2>
                        <button type="button" class="btn btn-success btn-add" id="addNewFeedbackBtn"><i
                                class="fas fa-plus-circle me-2"></i>Add New Feedback</button>
                    </div>
                    <p>Review and respond to feedback from your customers.</p>
                    <div id="feedback-list" class="row">
                        <div class="col-lg-6 mb-4" data-feedback-id="1">
                            <div class="card feedback-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="feedback-content">
                                            <h5>Michael Chen <small class="text-muted ms-2"> - 2 days ago</small></h5>
                                            <div class="feedback-rating text-warning mb-2" data-rating="4"><i
                                                    class="fas fa-star"></i><i class="fas fa-star"></i><i
                                                    class="fas fa-star"></i><i class="fas fa-star"></i><i
                                                    class="far fa-star"></i></div>
                                            <p class="card-text">"The food was delicious, especially the pasta. However,
                                                the service was a bit slow during peak hours. Overall a good
                                                experience."</p>
                                        </div>
                                        <div class="feedback-actions"><button
                                                class="btn btn-sm btn-icon btn-primary-custom me-1 edit-feedback-btn"
                                                title="Edit Feedback"><i class="fas fa-edit"></i></button><button
                                                class="btn btn-sm btn-icon btn-danger-custom delete-feedback-btn"
                                                title="Delete Feedback"><i class="fas fa-trash-alt"></i></button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4" data-feedback-id="2">
                            <div class="card feedback-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="feedback-content">
                                            <h5>Sarah Davis <small class="text-muted ms-2"> - 5 days ago</small></h5>
                                            <div class="feedback-rating text-warning mb-2" data-rating="5"><i
                                                    class="fas fa-star"></i><i class="fas fa-star"></i><i
                                                    class="fas fa-star"></i><i class="fas fa-star"></i><i
                                                    class="fas fa-star"></i></div>
                                            <p class="card-text">"Absolutely amazing! The ambiance, the food, the
                                                service - everything was perfect. Will definitely be coming back soon!"
                                            </p>
                                        </div>
                                        <div class="feedback-actions"><button
                                                class="btn btn-sm btn-icon btn-primary-custom me-1 edit-feedback-btn"
                                                title="Edit Feedback"><i class="fas fa-edit"></i></button><button
                                                class="btn btn-sm btn-icon btn-danger-custom delete-feedback-btn"
                                                title="Delete Feedback"><i class="fas fa-trash-alt"></i></button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Feedback Modal -->
                    <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="feedbackModalLabel">Feedback Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="feedbackForm">
                                        <input type="hidden" id="feedbackId">
                                        <div class="mb-3">
                                            <label for="feedbackCustomerName" class="form-label">Customer Name</label>
                                            <input type="text" class="form-control" id="feedbackCustomerName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Rating</label>
                                            <div class="rating-stars" id="modalRatingStars">
                                                <i class="far fa-star" data-value="1"></i>
                                                <i class="far fa-star" data-value="2"></i>
                                                <i class="far fa-star" data-value="3"></i>
                                                <i class="far fa-star" data-value="4"></i>
                                                <i class="far fa-star" data-value="5"></i>
                                            </div>
                                            <input type="hidden" id="feedbackRatingValue" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="feedbackComment" class="form-label">Comment</label>
                                            <textarea class="form-control" id="feedbackComment" rows="4"
                                                required></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button type="submit" form="feedbackForm" class="btn btn-primary-custom"
                                        id="saveFeedbackBtn">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settings-view" class="view">
                    <h2>Settings</h2>
                    <p>Configure general settings for the restaurant and dashboard.</p>
                    <div class="card form-card">
                        <div class="card-body">
                            <form id="settingsForm">
                                <h5 class="form-section-title">Restaurant Information</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3"><label for="restaurantName" class="form-label">Restaurant
                                            Name</label><input type="text" class="form-control" id="restaurantName"
                                            value="The Gourmet Place"></div>
                                    <div class="col-md-6 mb-3"><label for="restaurantPhone" class="form-label">Contact
                                            Phone</label><input type="tel" class="form-control" id="restaurantPhone"
                                            value="+1-202-555-0186"></div>
                                </div>
                                <div class="mb-3"><label for="restaurantAddress"
                                        class="form-label">Address</label><input type="text" class="form-control"
                                        id="restaurantAddress" value="742 Evergreen Terrace, Springfield"></div>
                                <hr class="my-4">
                                <h5 class="form-section-title">Financial Settings</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3"><label for="currencySymbol" class="form-label">Currency
                                            Symbol</label><input type="text" class="form-control" id="currencySymbol"
                                            value="$"></div>
                                    <div class="col-md-6 mb-3"><label for="taxRate" class="form-label">Tax Rate
                                            (%)</label><input type="number" class="form-control" id="taxRate"
                                            value="8.5"></div>
                                </div>
                                <div class="d-flex justify-content-end mt-3">
                                    <button type="submit" class="btn btn-primary-custom btn-lg"><i
                                            class="fas fa-save me-2"></i>Save Settings</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Logout View -->
                <div id="logout-view" class="view">
                    <div class="logout-container text-center">
                        <i class="fas fa-door-open fa-4x text-primary-custom mb-4"></i>
                        <h2>You are about to log out.</h2>
                        <p class="lead">Are you sure you want to end your current session?</p>
                        <div class="mt-4">
                            <button class="btn btn-danger btn-lg me-2" id="confirmLogoutBtn">Yes, Log Out</button>
                            <button class="btn btn-secondary btn-lg" id="cancelLogoutBtn">Stay Logged In</button>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'admind/assets/js/script.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Open the Bootstrap Modal
            const addBookingBtn = document.getElementById('addNewBookingBtn');
            const addOrderModalEl = document.getElementById('addOrderModal');
            const addOrderModal = new bootstrap.Modal(addOrderModalEl);

            addBookingBtn.addEventListener('click', function () {
                addOrderModal.show();
            });

            // Handle Add Order Form Submission
            const addOrderForm = document.getElementById('addOrderForm');
            addOrderForm.addEventListener('submit', function (e) {
                e.preventDefault();

                const customer = document.getElementById('customerName').value.trim();
                const time = document.getElementById('orderTime').value.trim();
                const status = document.getElementById('orderStatus').value;

                if (!customer || !time || !status) {
                    alert("Please fill out all fields.");
                    return;
                }

                // Send to backend
                fetch('/api/orders/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        customer_name: customer,
                        order_type: 'Dine-in',  // Default order_type
                        items: [],  // Empty items allowed now
                        status: status,
                        order_time: time  // Extra field, will be saved in MongoDB
                    })
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.message) {
                            alert('Order created successfully! ID: ' + data.order_id);
                            location.reload();
                        } else {
                            alert("Failed to create the order: " + data.error);
                        }
                    }).catch(error => {
                        console.error('Error:', error);
                        alert("Error creating order.");
                    });

                addOrderModal.hide();
                addOrderForm.reset();
            });

            // Delete Order
            const deleteButtons = document.querySelectorAll('.delete-order-btn');
            deleteButtons.forEach(btn => {
                btn.addEventListener('click', function () {
                    const orderId = this.dataset.id;

                    fetch(`/api/orders/${orderId}/`, {
                        method: 'DELETE',
                        headers: { 'X-CSRFToken': getCookie('csrftoken') }
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.message) {
                                alert("Order deleted successfully.");
                                location.reload();
                            } else {
                                alert("Failed to delete the order.");
                            }
                        }).catch(error => {
                            console.error('Error:', error);
                            alert("Error deleting order.");
                        });
                });
            });

            // Get CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        });
    </script>
    <!-- Add this new script block for navigation handling -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('#main-menu a');
            const views = document.querySelectorAll('.view');
            const title = document.getElementById('current-view-title');

            navLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const viewName = this.getAttribute('data-view');
                    const viewId = viewName + '-view';

                    // Hide all views
                    views.forEach(view => {
                        view.classList.remove('active-view');
                    });

                    // Show the selected view
                    const targetView = document.getElementById(viewId);
                    if (targetView) {
                        targetView.classList.add('active-view');
                    } else {
                        console.error(`View with ID ${viewId} not found.`);
                    }

                    // Update active menu item
                    navLinks.forEach(l => l.classList.remove('active-menu'));
                    this.classList.add('active-menu');

                    // Update page title
                    title.textContent = this.textContent.trim();

                    // Special handling for logout
                    if (viewName === 'logout') {
                        // You can add logout logic here, e.g., redirect to logout URL
                        // For now, just show the logout view
                    }
                });
            });

            // Dark mode toggle
            document.getElementById('theme-toggle').addEventListener('click', function () {
                document.body.classList.toggle('dark-mode');
                // Optional: Save preference to localStorage
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('theme', 'dark');
                } else {
                    localStorage.setItem('theme', 'light');
                }
            });

            // Load saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
            }

            // Initialize charts (example for userPieChart)
            const userPieChartCtx = document.getElementById('userPieChart').getContext('2d');
            new Chart(userPieChartCtx, {
                type: 'pie',
                data: {
                    labels: ['Admins', 'Customers', 'Staff'],
                    datasets: [{
                        data: [10, 50, 20],
                        backgroundColor: ['#3498db', '#1abc9c', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });

            // Add similar initialization for other charts like salesBarChart if needed
        });
    </script>
</body>

</html>